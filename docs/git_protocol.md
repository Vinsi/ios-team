# Git Protocol

A guide for programming within version control. Some rules are checked automatically by [Danger](danger.systems).

## Maintaining the repo

* Keep `.gitignore` file up to date and don't let the developer specific files to be included in source control;
* Delete local and remote branches after merging
* Don't commit directly to `master` branch. Try avoiding commit to `develop` branch.
* Perform work on a feature branch
* Rebase frequently

## New feature flow

Assume the related feature in JIRA has the `CNI-152` name.

* Checkout new branch, named as a related JIRA ticket. Usually root tasks should be started from develop. However in case of subtask the checkout can be done from root feature branch.
```
git checkout develop
git pull origin develop
git checkout -b CNI-152
```
* Commit frequently and start each message with the JIRA ticket number.
```
git commit -am 'CNI-152; Update CocoaPods dependencies;'
```
* Rebase frequently
```
git fetch origin
git rebase origin/develop
```
* After finishing worn on the feature, squash meaningless commits using interactive git rebase
```
git rebase -i origin/develop
```
* Push branch to remote
```
git push origin CNI-152
```
* Ask for review the team members

## Branches management

* If there is a JIRA ticket that is an Epic which has another JIRA sub-tickets then there should be an Epic branch for the Epic JIRA ticket and sub-branches from it for the JIRA sub-tickets.
* If any of the sub-branches is finished, it needs to be instantly rebased into the Epic branch. Developers expect that the Epic branch is always up to date.
* Rebasing is prefered instead of merging to have a clean history, but merging is only mandatory if you want to update any public branch (develop, epic feature branch) with other branches, and the public branch is already being used by another developer. Also, merging is prefered if rebasing will waste a very long time of resolving conflicts.
* Avoid force pushing into main branches (non-feature branches like develop or master branches) unless that this is aligned with the team with a reason for doing this.

## Git commits

* When any developer looks at the commits history, he/she should be able to easily understand what's behind every commit. History should be clean and all commits should be meaningful and should describe the output of the code written in the commit. So for example, "Update Changelog" commit is not meaningful and we should avoid such commits.
* Commit message should start with the JIRA ticket title followed by semi-colon, for example, `CNI-5805;`.
* If there is change (feature or bug fix) required for our SDK, make the change and commit in our private SDK. Our public SDK is released later-on with a fastlane in the public SDK repository itself by building frameworks from the latest private SDK.
* Then you should leave a space and write your commit message in the imperative: `Fix bug` and not `Fixed bug` or `Fixes bug`.  This convention matches up with commit messages generated by commands like git merge and git revert (Tim Pop, 2008).
* Then finally write a semi-colon. So it should be something like that `CNI-5805; Fix bug;`
